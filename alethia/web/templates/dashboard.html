{% extends "base.html" %}
{% block title %}Dashboard - Argus{% endblock %}
{% block content %}
<div class="animate-fade-in">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gradient mb-1">Dashboard</h1>
        <p class="text-sm text-gray-500">Your solve progress and statistics</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
        <div class="glass rounded-2xl p-6 glow-sm">
            <div class="text-xs font-semibold text-indigo-400 uppercase tracking-wider mb-2">Total Solves</div>
            <div class="text-3xl font-bold text-gray-200">{{ total_solves }}</div>
        </div>
        <div class="glass rounded-2xl p-6 glow-cyan">
            <div class="text-xs font-semibold text-cyan-400 uppercase tracking-wider mb-2">Successful</div>
            <div class="text-3xl font-bold" style="color:#34d399">{{ successful_solves }}</div>
            {% if total_solves > 0 %}
            <div class="text-xs text-gray-500 mt-1">{{ ((successful_solves / total_solves) * 100)|round|int }}% success rate</div>
            {% endif %}
        </div>
        <div class="glass rounded-2xl p-6 glow-purple">
            <div class="text-xs font-semibold text-purple-400 uppercase tracking-wider mb-2">Problems Created</div>
            <div class="text-3xl font-bold text-gray-200">{{ problems_created }}</div>
        </div>
    </div>

    {% if total_solves > 0 %}
    <!-- Charts -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="glass rounded-2xl p-6">
            <h2 class="text-xs font-semibold text-indigo-400 uppercase tracking-wider mb-4">Score Over Time</h2>
            <canvas id="scoreChart" height="200"></canvas>
        </div>
        <div class="glass rounded-2xl p-6">
            <h2 class="text-xs font-semibold text-indigo-400 uppercase tracking-wider mb-4">Score Distribution</h2>
            <canvas id="distChart" height="200"></canvas>
        </div>
    </div>
    {% else %}
    <div class="text-center py-16 glass rounded-2xl">
        <p class="text-gray-400 mb-4">No solve data yet. Solve some problems to see your stats!</p>
        <a href="/" class="btn-primary text-white px-6 py-3 rounded-xl text-sm font-semibold inline-block">Browse Problems</a>
    </div>
    {% endif %}
</div>

{% if total_solves > 0 %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
const chartData = {{ chart_data | safe }};
const distData = {{ score_dist_data | safe }};

// Score over time chart
const scoreCtx = document.getElementById('scoreChart').getContext('2d');
new Chart(scoreCtx, {
    type: 'line',
    data: {
        labels: chartData.map((d, i) => i + 1),
        datasets: [{
            label: 'Score %',
            data: chartData.map(d => Math.round(d.score * 100)),
            borderColor: '#818cf8',
            backgroundColor: 'rgba(129, 140, 248, 0.1)',
            fill: true,
            tension: 0.4,
            pointBackgroundColor: chartData.map(d => d.solved ? '#34d399' : '#f87171'),
            pointBorderColor: chartData.map(d => d.solved ? '#34d399' : '#f87171'),
            pointRadius: 5,
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: function(ctx) {
                        const d = chartData[ctx.dataIndex];
                        return `Score: ${ctx.raw}% | ${d.solved ? 'Accepted' : 'Rejected'} | ${d.attempts} attempts`;
                    }
                }
            }
        },
        scales: {
            y: {
                min: 0, max: 100,
                grid: { color: 'rgba(99, 102, 241, 0.08)' },
                ticks: { color: '#4a5568', callback: v => v + '%' }
            },
            x: {
                grid: { color: 'rgba(99, 102, 241, 0.05)' },
                ticks: { color: '#4a5568' },
                title: { display: true, text: 'Solve #', color: '#4a5568' }
            }
        }
    }
});

// Score distribution chart
const distCtx = document.getElementById('distChart').getContext('2d');
const buckets = ['0-20%', '20-40%', '40-60%', '60-80%', '80-100%'];
const bucketCounts = buckets.map(b => {
    const found = distData.find(d => d.bucket === b);
    return found ? found.count : 0;
});
new Chart(distCtx, {
    type: 'bar',
    data: {
        labels: buckets,
        datasets: [{
            label: 'Solves',
            data: bucketCounts,
            backgroundColor: ['#f87171', '#fb923c', '#fbbf24', '#34d399', '#22d3ee'],
            borderRadius: 6,
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: 'rgba(99, 102, 241, 0.08)' },
                ticks: { color: '#4a5568', stepSize: 1 }
            },
            x: {
                grid: { display: false },
                ticks: { color: '#4a5568' }
            }
        }
    }
});
</script>
{% endif %}
{% endblock %}
