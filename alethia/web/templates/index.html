{% extends "base.html" %}
{% block title %}Argus - Dashboard{% endblock %}
{% block content %}
<div class="animate-fade-in">
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gradient mb-1">Problems</h1>
            <p class="text-sm text-gray-500">Your coding challenges, solved by AI agents</p>
        </div>
        {% if current_user %}
        <a href="/import" class="glass-light text-gray-300 px-4 py-2 rounded-xl text-sm font-medium hover:bg-white/10 transition">
            Import JSON
        </a>
        {% endif %}
    </div>

    <!-- Filters -->
    {% if all_tags or problems %}
    <div class="glass rounded-2xl px-6 py-4 mb-6 flex flex-wrap items-center gap-3">
        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Filters:</span>
        <!-- Difficulty filter -->
        <div class="flex gap-1">
            <a href="{{ url_for('index', tag=tag_filter) }}"
               class="text-xs px-3 py-1 rounded-full transition {% if not difficulty_filter %}bg-indigo-500/20 text-indigo-300{% else %}glass-light text-gray-400 hover:text-gray-300{% endif %}">
                All
            </a>
            {% for d in ['easy', 'medium', 'hard'] %}
            <a href="{{ url_for('index', difficulty=d, tag=tag_filter) }}"
               class="text-xs px-3 py-1 rounded-full transition {% if difficulty_filter == d %}bg-indigo-500/20 text-indigo-300{% else %}glass-light text-gray-400 hover:text-gray-300{% endif %}">
                {{ d|capitalize }}
            </a>
            {% endfor %}
        </div>
        {% if all_tags %}
        <span class="text-gray-700">|</span>
        <div class="flex flex-wrap gap-1">
            {% if tag_filter %}
            <a href="{{ url_for('index', difficulty=difficulty_filter) }}"
               class="text-xs px-3 py-1 rounded-full glass-light text-gray-400 hover:text-gray-300 transition">
                All Tags
            </a>
            {% endif %}
            {% for tag in all_tags %}
            <a href="{{ url_for('index', tag=tag, difficulty=difficulty_filter) }}"
               class="text-xs px-3 py-1 rounded-full transition {% if tag_filter == tag %}bg-cyan-500/20 text-cyan-300{% else %}glass-light text-gray-400 hover:text-gray-300{% endif %}">
                {{ tag }}
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if problems %}
    <div class="glass rounded-2xl overflow-hidden glow-sm">
        <table class="w-full">
            <thead>
                <tr class="border-b border-white/5">
                    <th class="text-left px-6 py-4 text-xs font-semibold text-indigo-400 uppercase tracking-wider">Title</th>
                    <th class="text-left px-6 py-4 text-xs font-semibold text-indigo-400 uppercase tracking-wider hidden md:table-cell">Function Signature</th>
                    <th class="text-center px-6 py-4 text-xs font-semibold text-indigo-400 uppercase tracking-wider">Difficulty</th>
                    <th class="text-center px-6 py-4 text-xs font-semibold text-indigo-400 uppercase tracking-wider">Tests</th>
                    <th class="text-center px-6 py-4 text-xs font-semibold text-indigo-400 uppercase tracking-wider">Solves</th>
                    <th class="text-right px-6 py-4 text-xs font-semibold text-indigo-400 uppercase tracking-wider"></th>
                </tr>
            </thead>
            <tbody>
                {% for p in problems %}
                <tr class="row-hover border-b border-white/5 last:border-0">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            {% if not p.is_public %}
                            <svg class="w-4 h-4 text-gray-600 shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" title="Private">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/>
                            </svg>
                            {% endif %}
                            <a href="/problem/{{ p.slug }}" class="text-indigo-300 hover:text-cyan-300 font-medium transition-colors">{{ p.title }}</a>
                        </div>
                        {% if p.tags %}
                        <div class="flex flex-wrap gap-1 mt-1">
                            {% for tag in p.tags %}
                            <a href="{{ url_for('index', tag=tag, difficulty=difficulty_filter) }}"
                               class="text-xs px-2 py-0.5 rounded-full text-cyan-400/70 hover:text-cyan-300 transition-colors"
                               style="background:rgba(6,182,212,0.1)">{{ tag }}</a>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500 font-mono hidden md:table-cell">{{ p.function_signature or '—' }}</td>
                    <td class="px-6 py-4 text-center">
                        {% set diff_colors = {'easy': 'color:#34d399;background:rgba(52,211,153,0.1)', 'medium': 'color:#fbbf24;background:rgba(251,191,36,0.1)', 'hard': 'color:#f87171;background:rgba(248,113,113,0.1)'} %}
                        <span class="text-xs font-semibold px-2.5 py-1 rounded-full" style="{{ diff_colors.get(p.difficulty, diff_colors.medium) }}">
                            {{ p.difficulty|capitalize }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-lg glass-light text-sm font-mono text-cyan-400">{{ p.test_case_count }}</span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        {% if p.solution_count > 0 %}
                        <span class="inline-flex items-center justify-center px-2.5 py-1 rounded-full text-xs font-semibold" style="background:rgba(99,102,241,0.15);color:#818cf8">
                            {{ p.solution_count }}
                        </span>
                        {% else %}
                        <span class="text-gray-600 text-sm">—</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-right">
                        <a href="/problem/{{ p.slug }}" class="text-sm text-gray-500 hover:text-indigo-400 transition-colors">View &rarr;</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="text-center py-24 glass rounded-2xl border-gradient">
        <div class="w-16 h-16 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-indigo-500/20 to-cyan-500/20 flex items-center justify-center animate-float">
            <svg class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"/>
            </svg>
        </div>
        <p class="text-gray-400 mb-6 text-lg">No problems yet</p>
        {% if current_user %}
        <a href="/create" class="btn-primary text-white px-6 py-3 rounded-xl text-sm font-semibold inline-block">
            Create your first problem
        </a>
        {% else %}
        <a href="/signup" class="btn-primary text-white px-6 py-3 rounded-xl text-sm font-semibold inline-block">
            Sign up to get started
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
